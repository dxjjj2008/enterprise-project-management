# ç”˜ç‰¹å›¾æ¨¡å—è¯¦ç»†è®¾è®¡æ–‡æ¡£

> **ç‰ˆæœ¬**: v2.0  
> **åˆ›å»ºæ—¥æœŸ**: 2026-02-08  
> **æœ€åæ›´æ–°**: 2026-02-11  
> **çŠ¶æ€**: âœ… å·²å®Œæˆ

## 1. åŠŸèƒ½æ¦‚è¿°

ç”˜ç‰¹å›¾æ¨¡å—æä¾›é¡¹ç›®ä»»åŠ¡çš„æ—¶é—´è½´å¯è§†åŒ–å±•ç¤ºï¼Œæ”¯æŒä»»åŠ¡ä¾èµ–å…³ç³»å±•ç¤ºã€æ‹–æ‹½è°ƒæ•´æ—¥æœŸã€è¿›åº¦è¿½è¸ªç­‰åŠŸèƒ½ã€‚

### 1.1 æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| æ—¶é—´è½´è§†å›¾ | æ”¯æŒæ—¥/å‘¨/æœˆä¸‰ç§è§†å›¾æ¨¡å¼ | P0 |
| ä»»åŠ¡æ¡æ¸²æŸ“ | å±•ç¤ºä»»åŠ¡åç§°ã€è¿›åº¦ã€ä¼˜å…ˆçº§ | P0 |
| ä¾èµ–å…³ç³»çº¿ | ç»˜åˆ¶ä»»åŠ¡é—´çš„ä¾èµ–å…³ç³» | P1 |
| æ‹–æ‹½è°ƒæ•´ | æ‹–æ‹½ä»»åŠ¡æ¡è°ƒæ•´æ—¥æœŸ | P1 |
| ç¼©æ”¾æ§åˆ¶ | è°ƒæ•´æ—¶é—´è½´ç¼©æ”¾çº§åˆ« | P2 |
| é‡Œç¨‹ç¢‘æ ‡è®° | ç‰¹æ®Šæ ‡è®°é‡è¦èŠ‚ç‚¹ | P1 |
| ä»Šæ—¥çº¿ | é«˜äº®å½“å‰æ—¥æœŸä½ç½® | P2 |
| å¯¼å‡ºåŠŸèƒ½ | å¯¼å‡ºPNG/PDF/Excel | P2 |

### 1.2 æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Gantt Container                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Toolbar  â”‚  æ—¶é—´è½´å¤´éƒ¨ (æœˆä»½/æ—¥æœŸæ˜¾ç¤º)              â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  ä»»åŠ¡åç§°   â”‚  ç”˜ç‰¹å›¾å›¾è¡¨åŒº                            â”‚ â”‚
â”‚  â”‚    åˆ—è¡¨    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚             â”‚  â”‚  æ—¶é—´ç½‘æ ¼ + ä»»åŠ¡æ¡ + ä¾èµ–çº¿ + ä»Šæ—¥çº¿ â”‚ â”‚ â”‚
â”‚  â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     åº•éƒ¨ç»Ÿè®¡æ                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. ç»„ä»¶ç»“æ„

### 2.1 æ–‡ä»¶ç»“æ„

```
src/frontend/src/
â”œâ”€â”€ views/projects/
â”‚   â”œâ”€â”€ Gantt.vue                    # ç”˜ç‰¹å›¾ä¸»ç»„ä»¶ (778è¡Œ)
â”‚   â””â”€â”€ GanttDialog.vue              # ä»»åŠ¡åˆ›å»º/ç¼–è¾‘å¯¹è¯æ¡†
â”œâ”€â”€ api/
â”‚   â””â”€â”€ gantt.ts                     # ç”˜ç‰¹å›¾ API å®¢æˆ·ç«¯
â””â”€â”€ types/
    â””â”€â”€ gantt.ts                     # TypeScript ç±»å‹å®šä¹‰

src/backend/app/api/v1/
â””â”€â”€ gantt.py                        # ç”˜ç‰¹å›¾åç«¯ API
```

### 2.2 ç»„ä»¶èŒè´£

| ç»„ä»¶ | èŒè´£ |
|------|------|
| Gantt.vue | ä¸»å®¹å™¨ï¼Œåè°ƒå„æ¨¡å— |
| GanttToolbar | å·¥å…·æ ï¼ˆé¡¹ç›®é€‰æ‹©ã€è§†å›¾åˆ‡æ¢ã€ç¼©æ”¾æ§åˆ¶ï¼‰ |
| GanttHeader | æ—¶é—´è½´å¤´éƒ¨ |
| GanttBody | ä»»åŠ¡åˆ—è¡¨å’Œå›¾è¡¨åŒº |
| GanttTaskRow | å•ä¸ªä»»åŠ¡è¡Œ |
| GanttTaskBar | ä»»åŠ¡æ¡æ¸²æŸ“ |
| GanttDependencyLines | ä¾èµ–å…³ç³»çº¿ |
| GanttTodayLine | ä»Šæ—¥ä½ç½®çº¿ |

## 3. æ•°æ®ç»“æ„

### 3.1 GanttTask æ¥å£

```typescript
interface GanttTask {
  // åŸºç¡€ä¿¡æ¯
  id: number
  project_id: number
  parent_id: number | null
  title: string
  description?: string

  // çŠ¶æ€ä¿¡æ¯
  status: 'todo' | 'in_progress' | 'review' | 'done' | 'archived'
  priority: 'low' | 'medium' | 'high' | 'urgent'
  progress: number  // 0-100

  // æ—¶é—´ä¿¡æ¯
  start_date: string | null  // ISOæ ¼å¼
  due_date: string | null
  completed_at?: string

  // å…³ç³»ä¿¡æ¯
  assignee_id?: number
  assignee_name?: string
  assignee_avatar?: string
  dependencies: number[]  // ä¾èµ–çš„ä»»åŠ¡IDåˆ—è¡¨

  // ç±»å‹æ ‡è¯†
  is_milestone: boolean
  is_group: boolean

  // UIçŠ¶æ€
  expanded?: boolean
  selected?: boolean
  children?: GanttTask[]
}
```

### 3.2 GanttConfig é…ç½®

```typescript
interface GanttConfig {
  view_mode: 'day' | 'week' | 'month'
  day_width: number        // é»˜è®¤40px
  row_height: number       // é»˜è®¤48px
  show_weekends: boolean   // æ˜¯å¦æ˜¾ç¤ºå‘¨æœ«
  show_today: boolean     // æ˜¯å¦æ˜¾ç¤ºä»Šæ—¥çº¿
  show_progress: boolean  // æ˜¯å¦æ˜¾ç¤ºè¿›åº¦
  show_dependencies: boolean  // æ˜¯å¦æ˜¾ç¤ºä¾èµ–çº¿
}
```

## 4. API æ¥å£è®¾è®¡

### 4.1 RESTful API

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| GET | /api/v1/projects/{id}/gantt | è·å–ç”˜ç‰¹å›¾ä»»åŠ¡åˆ—è¡¨ |
| GET | /api/v1/projects/{id}/gantt/config | è·å–ç”˜ç‰¹å›¾é…ç½® |
| PUT | /api/v1/projects/{id}/gantt/config | æ›´æ–°ç”˜ç‰¹å›¾é…ç½® |
| GET | /api/v1/projects/{id}/gantt/stats | è·å–ç”˜ç‰¹å›¾ç»Ÿè®¡ |
| PUT | /api/v1/projects/{id}/tasks/{task_id}/dates | æ›´æ–°ä»»åŠ¡æ—¥æœŸ |
| PUT | /api/v1/projects/{id}/tasks/{task_id}/progress | æ›´æ–°ä»»åŠ¡è¿›åº¦ |
| POST | /api/v1/projects/{id}/tasks/{task_id}/dependencies | æ·»åŠ ä»»åŠ¡ä¾èµ– |
| DELETE | /api/v1/projects/{id}/tasks/{task_id}/dependencies/{dep_id} | åˆ é™¤ä»»åŠ¡ä¾èµ– |
| GET | /api/v1/projects/{id}/milestones | è·å–é‡Œç¨‹ç¢‘ |
| GET | /api/v1/projects/{id}/gantt/export | å¯¼å‡ºç”˜ç‰¹å›¾ |

### 4.2 è¯·æ±‚/å“åº”ç¤ºä¾‹

#### è·å–ç”˜ç‰¹å›¾ä»»åŠ¡

```json
// GET /api/v1/projects/1/gantt

Response 200:
{
  "items": [
    {
      "id": 1,
      "title": "éœ€æ±‚åˆ†æ",
      "status": "done",
      "priority": "high",
      "progress": 100,
      "start_date": "2026-02-01",
      "due_date": "2026-02-05",
      "dependencies": [],
      "is_milestone": false,
      "is_group": true,
      "expanded": true
    }
  ]
}
```

## 5. åŠŸèƒ½å®ç°è¯¦æƒ…

### 5.1 æ—¶é—´è½´è®¡ç®—

```typescript
// è®¡ç®—å¯è§æ—¥æœŸèŒƒå›´
const visibleDays = computed(() => {
  const days = []
  const start = new Date('2026-02-01')
  const end = new Date('2026-03-15')

  for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
    days.push({
      date: d.toISOString().split('T')[0],
      day: d.getDate(),
      isWeekend: d.getDay() === 0 || d.getDay() === 6
    })
  }
  return days
})

// è®¡ç®—æœˆä»½åˆ†ç»„
const visibleMonths = computed(() => {
  const months = []
  const monthMap = new Map()

  visibleDays.value.forEach(day => {
    const [year, month] = day.date.split('-')
    const key = `${year}-${month}`
    if (!monthMap.has(key)) {
      monthMap.set(key, { key, label: `${month}æœˆ`, days: 0 })
    }
    monthMap.get(key).days++
  })

  monthMap.forEach(value => months.push(value))
  return months
})
```

### 5.2 ä»»åŠ¡æ¡ä½ç½®è®¡ç®—

```typescript
const getTaskBarStyle = (task: GanttTask) => {
  const startIndex = visibleDays.value.findIndex(d => d.date === task.start_date)
  const endIndex = visibleDays.value.findIndex(d => d.date === task.due_date)

  if (startIndex === -1) return { display: 'none' }

  const left = startIndex * dayWidth.value
  const width = Math.max((endIndex - startIndex + 1) * dayWidth.value, dayWidth.value)

  return {
    left: `${left}px`,
    width: `${width}px`
  }
}
```

### 5.3 ä¾èµ–çº¿ç»˜åˆ¶

```typescript
interface Point {
  x: number
  y: number
}

interface DependencyLine {
  from: Point
  to: Point
}

const getDependencyPath = (task: GanttTask, depId: number): string => {
  const depTask = tasks.value.find(t => t.id === depId)
  if (!depTask) return ''

  const taskIndex = tasks.value.indexOf(task)
  const depIndex = tasks.value.indexOf(depTask)

  const fromX = (new Date(task.start_date).getTime() - minDate) / dayMs * dayWidth.value
  const toX = (new Date(depTask.start_date).getTime() - minDate) / dayMs * dayWidth.value

  return `M ${fromX} ${taskIndex * 48 + 24}
          L ${fromX + 20} ${taskIndex * 48 + 24}
          L ${fromX + 20} ${depIndex * 48 + 24}
          L ${toX} ${depIndex * 48 + 24}`
}
```

## 6. ç•Œé¢è®¾è®¡

### 6.1 å·¥å…·æ å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [é€‰æ‹©é¡¹ç›® â–¼]   [æ—¥] [å‘¨] [æœˆ]          [ğŸ”+] [ğŸ”] [â†“å¯¼å‡º] [â›¶]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 ä»»åŠ¡æ¡æ ·å¼

```scss
.task-bar {
  position: absolute;
  top: 10px;
  height: 28px;
  border-radius: 4px;
  cursor: pointer;

  // ä¼˜å…ˆçº§é¢œè‰²
  &.priority-high {
    background: linear-gradient(90deg, #f56c6c, #e6a23c);
  }

  &.priority-medium {
    background: linear-gradient(90deg, #409eff, #67c23a);
  }

  &.priority-low {
    background: linear-gradient(90deg, #909399, #c0c4cc);
  }

  // é‡Œç¨‹ç¢‘æ ·å¼
  &.is-milestone {
    width: 20px !important;
    height: 20px;
    transform: rotate(45deg);
    background: #f56c6c;
  }
}
```

## 7. äº¤äº’è®¾è®¡

### 7.1 æ‹–æ‹½è°ƒæ•´

| æ“ä½œ | æ•ˆæœ |
|------|------|
| æ‹–æ‹½ä»»åŠ¡æ¡å·¦ä¾§ | è°ƒæ•´å¼€å§‹æ—¥æœŸ |
| æ‹–æ‹½ä»»åŠ¡æ¡å³ä¾§ | è°ƒæ•´ç»“æŸæ—¥æœŸ |
| æ‹–æ‹½ä»»åŠ¡æ¡ä¸­é—´ | åŒæ—¶ç§»åŠ¨èµ·æ­¢æ—¥æœŸ |
| åŒå‡»ä»»åŠ¡æ¡ | æ‰“å¼€ç¼–è¾‘å¯¹è¯æ¡† |

### 7.2 å¿«æ·é”®

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| `+` / `=` | æ”¾å¤§æ—¶é—´è½´ |
| `-` | ç¼©å°æ—¶é—´è½´ |
| `1` | æ—¥è§†å›¾ |
| `2` | å‘¨è§†å›¾ |
| `3` | æœˆè§†å›¾ |
| `N` | æ–°å»ºä»»åŠ¡ |
| `Delete` | åˆ é™¤é€‰ä¸­ä»»åŠ¡ |
| `Enter` | ç¼–è¾‘é€‰ä¸­ä»»åŠ¡ |

## 8. æ€§èƒ½ä¼˜åŒ–

### 8.1 è™šæ‹Ÿæ»šåŠ¨

å¯¹äºè¶…è¿‡1000ä¸ªä»»åŠ¡çš„æƒ…å†µï¼Œéœ€è¦å®ç°è™šæ‹Ÿæ»šåŠ¨ï¼š

```typescript
// åªæ¸²æŸ“å¯è§åŒºåŸŸçš„ä»»åŠ¡
const visibleTasks = computed(() => {
  const start = Math.floor(scrollTop.value / rowHeight.value)
  const end = start + Math.ceil(containerHeight.value / rowHeight.value)
  return tasks.value.slice(start, end)
})
```

### 8.2 é˜²æŠ–æ›´æ–°

```typescript
// æ‹–æ‹½ç»“æŸåçš„é˜²æŠ–æ›´æ–°
const debouncedUpdate = debounce((task: GanttTask) => {
  updateTaskDates(task.id, {
    start_date: task.start_date,
    due_date: task.due_date
  })
}, 500)
```

## 9. æµ‹è¯•ç­–ç•¥

### 9.1 æµ‹è¯•ç”¨ä¾‹

| æµ‹è¯•ç±»å‹ | æµ‹è¯•å†…å®¹ |
|----------|----------|
| å•å…ƒæµ‹è¯• | æ—¶é—´è½´è®¡ç®—ã€ä½ç½®è®¡ç®—ã€ä¾èµ–çº¿è®¡ç®— |
| ç»„ä»¶æµ‹è¯• | ä»»åŠ¡æ¡æ¸²æŸ“ã€äº¤äº’å“åº” |
| E2Eæµ‹è¯• | å®Œæ•´æ‹–æ‹½æµç¨‹ã€APIé›†æˆ |

### 9.2 æµ‹è¯•è¦†ç›–ç›®æ ‡

- å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- ç»„ä»¶æµ‹è¯•è¦†ç›–ä¸»è¦äº¤äº’
- E2Eæµ‹è¯•è¦†ç›–æ ¸å¿ƒæµç¨‹

## 10. å¾…åŠäº‹é¡¹

| ä»»åŠ¡ | çŠ¶æ€ | é¢„è®¡å·¥æ—¶ |
|------|------|----------|
| ç”˜ç‰¹å›¾ç»„ä»¶åŸºç¡€æ¡†æ¶ | âœ… å·²å®Œæˆ | 2h |
| æ—¶é—´è½´æ¸²æŸ“ | âœ… å·²å®Œæˆ | 2h |
| ä»»åŠ¡æ¡ç»„ä»¶ | âœ… å·²å®Œæˆ | 3h |
| ä¾èµ–çº¿ç»˜åˆ¶ | ğŸ”¶ è¿›è¡Œä¸­ | 2h |
| æ‹–æ‹½è°ƒæ•´åŠŸèƒ½ | â³ å¾…å¼€å§‹ | 2h |
| APIé›†æˆ | â³ å¾…å¼€å§‹ | 1h |
| å¯¼å‡ºåŠŸèƒ½å®Œå–„ | â³ å¾…å¼€å§‹ | 1h |
| å•å…ƒæµ‹è¯• | â³ å¾…å¼€å§‹ | 2h |

## 11. ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | é“¾æ¥ |
|------|------|
| ç”˜ç‰¹å›¾å®æ–½è®¡åˆ’ | [2026-02-08-gantt-chart-plan.md](../../plans/2026-02-08-gantt-chart-plan.md) |
| ç”¨æˆ·æ‰‹å†Œ | [2026-02-08-user-manual.md](../../manual/2026-02-08-user-manual.md) |
| APIæ–‡æ¡£ | [2026-02-08-api.md](../../api/2026-02-08-api.md) |

---

**ä½œè€…**: å¼€å‘å›¢é˜Ÿ  
**ç‰ˆæœ¬**: v2.0  
**æœ€åæ›´æ–°**: 2026-02-11
