# 企业项目管理系统 - API 文档

**版本**: v1.0  
**创建日期**: 2026-02-08  
**Base URL**: `/api/v1`

---

## 1. 认证

### 1.1 登录
```
POST /auth/login
Content-Type: application/json

Request:
{
  "email": "user@example.com",
  "password": "password123"
}

Response (200):
{
  "code": 0,
  "message": "success",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "name": "张经理",
      "email": "user@example.com",
      "avatar": "https://...",
      "role": "manager"
    }
  }
}
```

### 1.2 登出
```
POST /auth/logout
Authorization: Bearer {token}

Response (200):
{
  "code": 0,
  "message": "success"
}
```

### 1.3 获取当前用户
```
GET /auth/me
Authorization: Bearer {token}

Response (200):
{
  "code": 0,
  "data": {
    "id": 1,
    "name": "张经理",
    "email": "user@example.com",
    "avatar": "https://...",
    "role": "manager"
  }
}
```

---

## 2. 项目管理

### 2.1 项目列表
```
GET /projects
Authorization: Bearer {token}

Query Parameters:
- page: 页码 (默认: 1)
- page_size: 每页数量 (默认: 20)
- status: 状态筛选 (all/in_progress/completed/archived)
- search: 关键词搜索
- order_by: 排序字段 (created_at/updated_at)
- order: 排序方向 (asc/desc)

Response (200):
{
  "code": 0,
  "data": {
    "list": [
      {
        "id": 1,
        "name": "企业项目管理系统 V1.0",
        "description": "项目描述...",
        "status": "in_progress",
        "progress": 65,
        "start_date": "2026-01-01",
        "end_date": "2026-03-31",
        "owner": {
          "id": 1,
          "name": "张经理",
          "avatar": "https://..."
        },
        "member_count": 5,
        "task_count": 156,
        "completed_task_count": 89,
        "created_at": "2026-01-01 00:00:00",
        "updated_at": "2026-02-08 10:00:00"
      }
    ],
    "pagination": {
      "page": 1,
      "page_size": 20,
      "total": 12
    }
  }
}
```

### 2.2 创建项目
```
POST /projects
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
  "name": "新项目名称",
  "description": "项目描述",
  "start_date": "2026-02-01",
  "end_date": "2026-05-31",
  "owner_id": 1
}

Response (201):
{
  "code": 0,
  "message": "success",
  "data": {
    "id": 13,
    "name": "新项目名称",
    "status": "draft",
    "created_at": "2026-02-08 10:00:00"
  }
}
```

### 2.3 项目详情
```
GET /projects/{id}
Authorization: Bearer {token}

Response (200):
{
  "code": 0,
  "data": {
    "id": 1,
    "name": "企业项目管理系统 V1.0",
    "description": "项目描述...",
    "status": "in_progress",
    "progress": 65,
    "start_date": "2026-01-01",
    "end_date": "2026-03-31",
    "owner": {
      "id": 1,
      "name": "张经理",
      "avatar": "https://..."
    },
    "members": [
      {
        "id": 1,
        "name": "张经理",
        "avatar": "https://...",
        "role": "owner"
      }
    ],
    "task_stats": {
      "total": 156,
      "completed": 89,
      "in_progress": 42,
      "pending": 18,
      "overdue": 7
    },
    "milestones": [],
    "created_at": "2026-01-01 00:00:00",
    "updated_at": "2026-02-08 10:00:00"
  }
}
```

### 2.4 更新项目
```
PUT /projects/{id}
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
  "name": "更新后的项目名称",
  "description": "更新后的描述",
  "status": "in_progress"
}

Response (200):
{
  "code": 0,
  "message": "success"
}
```

### 2.5 删除项目
```
DELETE /projects/{id}
Authorization: Bearer {token}

Response (200):
{
  "code": 0,
  "message": "success"
}
```

---

## 3. 任务管理

### 3.1 任务列表
```
GET /projects/{project_id}/tasks
Authorization: Bearer {token}

Query Parameters:
- page: 页码
- page_size: 每页数量
- status: 状态筛选
- priority: 优先级筛选
- assignee_id: 负责人筛选
- search: 关键词搜索

Response (200):
{
  "code": 0,
  "data": {
    "list": [
      {
        "id": 1,
        "title": "完成需求文档编写",
        "description": "详细描述...",
        "status": "done",
        "priority": "high",
        "assignee": {
          "id": 1,
          "name": "张经理",
          "avatar": "https://..."
        },
        "due_date": "2026-02-15",
        "project_id": 1,
        "subtask_count": 5,
        "completed_subtask_count": 3,
        "created_at": "2026-01-01 00:00:00",
        "updated_at": "2026-02-08 10:00:00"
      }
    ],
    "pagination": {...}
  }
}
```

### 3.2 创建任务
```
POST /projects/{project_id}/tasks
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
  "title": "新任务标题",
  "description": "任务描述",
  "priority": "high",
  "assignee_id": 1,
  "due_date": "2026-02-20",
  "parent_id": null
}

Response (201):
{
  "code": 0,
  "message": "success",
  "data": {
    "id": 157,
    "title": "新任务标题",
    "status": "todo",
    "created_at": "2026-02-08 10:00:00"
  }
}
```

### 3.3 任务详情
```
GET /tasks/{id}
Authorization: Bearer {token}

Response (200):
{
  "code": 0,
  "data": {
    "id": 1,
    "title": "完成需求文档编写",
    "description": "详细描述...",
    "status": "done",
    "priority": "high",
    "assignee": {
      "id": 1,
      "name": "张经理",
      "avatar": "https://..."
    },
    "project": {
      "id": 1,
      "name": "企业项目管理系统 V1.0"
    },
    "due_date": "2026-02-15",
    "subtasks": [
      {
        "id": 1,
        "title": "子任务1",
        "done": true
      }
    ],
    "comments": [
      {
        "id": 1,
        "user_id": 1,
        "user_name": "张经理",
        "content": "评论内容",
        "created_at": "2026-02-08 10:00:00"
      }
    ],
    "created_at": "2026-01-01 00:00:00",
    "updated_at": "2026-02-08 10:00:00"
  }
}
```

### 3.4 更新任务
```
PUT /tasks/{id}
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
  "title": "更新后的标题",
  "status": "in_progress",
  "priority": "medium",
  "assignee_id": 2
}

Response (200):
{
  "code": 0,
  "message": "success"
}
```

### 3.5 更新任务状态
```
PATCH /tasks/{id}/status
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
  "status": "done"
}

Response (200):
{
  "code": 0,
  "message": "success"
}
```

### 3.6 删除任务
```
DELETE /tasks/{id}
Authorization: Bearer {token}

Response (200):
{
  "code": 0,
  "message": "success"
}
```

### 3.7 子任务管理
```
POST /tasks/{task_id}/subtasks
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
  "title": "子任务标题"
}

Response (201):
{
  "code": 0,
  "data": {
    "id": 158,
    "title": "子任务标题",
    "done": false
  }
}
```

### 3.8 任务评论
```
POST /tasks/{task_id}/comments
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
  "content": "评论内容"
}

Response (201):
{
  "code": 0,
  "data": {
    "id": 1,
    "user_id": 1,
    "content": "评论内容",
    "created_at": "2026-02-08 10:00:00"
  }
}
```

---

## 4. 计划管理

### 4.1 计划版本列表
```
GET /projects/{project_id}/plans
Authorization: Bearer {token}

Response (200):
{
  "code": 0,
  "data": [
    {
      "id": 1,
      "version": "V1.0",
      "status": "approved",
      "is_baseline": true,
      "created_by": {
        "id": 1,
        "name": "张经理"
      },
      "created_at": "2026-01-01 00:00:00"
    }
  ]
}
```

### 4.2 创建计划版本
```
POST /projects/{project_id}/plans
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
  "version": "V1.1",
  "description": "计划变更说明",
  "tasks": [
    {
      "title": "任务1",
      "start_date": "2026-02-01",
      "end_date": "2026-02-15",
      "assignee_id": 1
    }
  ]
}

Response (201):
{
  "code": 0,
  "message": "success",
  "data": {
    "id": 2,
    "version": "V1.1",
    "status": "pending_approval"
  }
}
```

### 4.3 计划对比
```
GET /projects/{project_id}/plans/{plan_id}/compare
Authorization: Bearer {token}

Query Parameters:
- baseline_id: 基线版本ID

Response (200):
{
  "code": 0,
  "data": {
    "added": [],
    "removed": [],
    "modified": [],
    "unchanged": []
  }
}
```

### 4.4 提交审批
```
POST /projects/{project_id}/plans/{plan_id}/submit
Authorization: Bearer {token}

Response (200):
{
  "code": 0,
  "message": "success"
}
```

---

## 5. 审批管理

### 5.1 审批列表
```
GET /approvals
Authorization: Bearer {token}

Query Parameters:
- type: 类型筛选 (all/pending/my)
- page: 页码

Response (200):
{
  "code": 0,
  "data": {
    "list": [
      {
        "id": 1,
        "type": "plan_change",
        "title": "计划变更 V1.1",
        "status": "pending",
        "applicant": {
          "id": 1,
          "name": "张经理"
        },
        "project": {
          "id": 1,
          "name": "企业项目管理系统"
        },
        "created_at": "2026-02-08 10:00:00"
      }
    ],
    "pagination": {...}
  }
}
```

### 5.2 审批详情
```
GET /approvals/{id}
Authorization: Bearer {token}

Response (200):
{
  "code": 0,
  "data": {
    "id": 1,
    "type": "plan_change",
    "title": "计划变更 V1.1",
    "status": "pending",
    "content": {
      "plan_id": 2,
      "changes": []
    },
    "applicant": {
      "id": 1,
      "name": "张经理"
    },
    "project": {
      "id": 1,
      "name": "企业项目管理系统"
    },
    "histories": [
      {
        "action": "submitted",
        "user_id": 1,
        "created_at": "2026-02-08 10:00:00"
      }
    ]
  }
}
```

### 5.3 审批操作
```
POST /approvals/{id}/approve
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
  "comment": "审批意见"
}

Response (200):
{
  "code": 0,
  "message": "success"
}
```

### 5.4 驳回审批
```
POST /approvals/{id}/reject
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
  "comment": "驳回原因"
}

Response (200):
{
  "code": 0,
  "message": "success"
}
```

---

## 6. 风险/问题管理

### 6.1 风险列表
```
GET /projects/{project_id}/risks
Authorization: Bearer {token}

Query Parameters:
- level: 等级筛选 (high/medium/low)
- status: 状态筛选

Response (200):
{
  "code": 0,
  "data": [
    {
      "id": 1,
      "title": "技术风险",
      "level": "high",
      "status": "identified",
      "probability": "high",
      "impact": "high",
      "mitigation": "应对措施",
      "owner": {
        "id": 1,
        "name": "张经理"
      },
      "created_at": "2026-01-01 00:00:00"
    }
  ]
}
```

### 6.2 问题列表
```
GET /projects/{project_id}/issues
Authorization: Bearer {token}

Response (200):
{
  "code": 0,
  "data": [
    {
      "id": 1,
      "title": "性能问题",
      "severity": "high",
      "status": "open",
      "assignee": {
        "id": 1,
        "name": "张经理"
      },
      "created_at": "2026-01-01 00:00:00"
    }
  ]
}
```

---

## 7. 统计报表

### 7.1 仪表盘统计
```
GET /dashboard/stats
Authorization: Bearer {token}

Response (200):
{
  "code": 0,
  "data": {
    "projects": {
      "total": 16,
      "in_progress": 12,
      "completed": 4
    },
    "tasks": {
      "total": 156,
      "completed": 89,
      "in_progress": 42,
      "pending": 18,
      "overdue": 7
    },
    "issues": {
      "total": 68,
      "open": 23,
      "closed": 45
    },
    "risks": {
      "total": 16,
      "controlled": 12,
      "uncontrolled": 4
    },
    "approvals": {
      "pending": 3
    }
  }
}
```

### 7.2 项目统计
```
GET /projects/{project_id}/stats
Authorization: Bearer {token}

Response (200):
{
  "code": 0,
  "data": {
    "progress": 65,
    "task_stats": {
      "total": 156,
      "completed": 89,
      "in_progress": 42,
      "pending": 18,
      "overdue": 7
    },
    "risk_stats": {
      "high": 3,
      "medium": 5,
      "low": 8
    },
    "issue_stats": {
      "open": 15,
      "in_progress": 8,
      "closed": 45
    }
  }
}
```

---

## 8. 搜索

### 8.1 全局搜索
```
GET /search
Authorization: Bearer {token}

Query Parameters:
- q: 搜索关键词
- type: 类型筛选 (all/project/task/issue)

Response (200):
{
  "code": 0,
  "data": {
    "projects": [
      {
        "id": 1,
        "name": "企业项目管理系统 V1.0"
      }
    ],
    "tasks": [
      {
        "id": 1,
        "title": "完成需求文档编写",
        "project_id": 1
      }
    ],
    "issues": []
  }
}
```

---

## 9. 用户管理

### 9.1 用户列表
```
GET /users
Authorization: Bearer {token}

Response (200):
{
  "code": 0,
  "data": [
    {
      "id": 1,
      "name": "张经理",
      "email": "user@example.com",
      "avatar": "https://...",
      "role": "manager",
      "department": "技术部"
    }
  ]
}
```

---

## 10. 错误码说明

| 错误码 | 说明 |
|--------|------|
| 0 | 成功 |
| 40001 | 参数错误 |
| 40101 | 未登录 |
| 40301 | 无权限 |
| 40401 | 资源不存在 |
| 50001 | 服务器错误 |

---

## 11. 变更记录

| 日期 | 版本 | 变更内容 |
|------|------|---------|
| 2026-02-08 | v1.0 | 初始API文档 |
