# ä¼ä¸šé¡¹ç›®ç®¡ç†ç³»ç»Ÿ - API æ–‡æ¡£

**ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-02-08  
**æœ€åæ›´æ–°**: 2026-02-10  
**Base URL**: `http://localhost:8000/api/v1`

---

## ğŸ“ æ›´æ–°æ—¥å¿—

| æ—¥æœŸ | ç‰ˆæœ¬ | æ›´æ–°å†…å®¹ |
|------|------|----------|
| 2026-02-10 | v1.1 | é¡¹ç›®Keyæ”¹ä¸ºç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼ˆPJ+6ä½æµæ°´å·ï¼‰ |
| 2026-02-10 | v1.1 | æ–°å¢ `/projects/next-key` APIç«¯ç‚¹ |

---

## å‰ç«¯é›†æˆè¯´æ˜

### ç¯å¢ƒé…ç½®

å‰ç«¯é€šè¿‡ `src/api/index.ts` ä¸­çš„ `API_BASE_URL` é…ç½®åç«¯åœ°å€ï¼š

```typescript
const getApiBaseUrl = () => {
  if (import.meta.env.VITE_API_URL) {
    return import.meta.env.VITE_API_URL
  }
  return 'http://localhost:8000/api/v1/'
}
```

æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡ `VITE_API_URL` é…ç½®åç«¯åœ°å€ã€‚

### è®¤è¯æµç¨‹

1. ç”¨æˆ·ç™»å½• â†’ POST `/auth/login` â†’ è·å– JWT Token
2. Token å­˜å‚¨åœ¨ `localStorage.getItem('auth_token')`
3. åç»­è¯·æ±‚è‡ªåŠ¨æºå¸¦ Authorization Header

---

## 1. è®¤è¯

### 1.1 ç™»å½•
```
POST /auth/login
Content-Type: application/x-www-form-urlencoded

Request:
username=user&password=password123

Response (200):
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "user": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "full_name": "Test User",
    "role": "member"
  }
}
```

### 1.2 æ³¨å†Œ
```
POST /auth/register

Request:
- username: string (required)
- email: string (required)
- password: string (required)
- full_name: string (optional)

Response (200):
{
  "message": "User registered successfully",
  "user": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "full_name": "Test User"
  }
}
```

### 1.3 è·å–å½“å‰ç”¨æˆ·
```
GET /auth/me
Authorization: Bearer {token}

Response (200):
{
  "id": 1,
  "username": "testuser",
  "email": "test@example.com",
  "full_name": "Test User",
  "phone": null,
  "avatar": null,
  "role": "member",
  "is_active": true,
  "created_at": "2026-02-08T10:00:00",
  "last_login": "2026-02-10T10:00:00"
}
```

### 1.4 æ›´æ–°å½“å‰ç”¨æˆ·
```
PUT /auth/me
Authorization: Bearer {token}

Request:
- full_name: string (optional)
- phone: string (optional)

Response (200):
{
  "message": "User updated successfully",
  "user": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "full_name": "Updated Name",
    "phone": "13800138000"
  }
}
```

### 1.5 ä¿®æ”¹å¯†ç 
```
POST /auth/change-password
Authorization: Bearer {token}

Request:
- old_password: string (required)
- new_password: string (required, min_length=8)

Response (200):
{
  "message": "Password changed successfully"
}
```

### 1.6 åˆ·æ–°ä»¤ç‰Œ
```
POST /auth/refresh
Authorization: Bearer {token}

Response (200):
{
  "access_token": "new_token...",
  "token_type": "bearer"
}
```

---

## 2. é¡¹ç›®ç®¡ç†

### 2.1 é¡¹ç›®åˆ—è¡¨
```
GET /projects
Authorization: Bearer {token}

Query Parameters:
- skip: number (default: 0)
- limit: number (default: 100)
- status: planning | active | on_hold | completed | archived

Response (200):
{
  "items": [
    {
      "id": 1,
      "name": "ä¼ä¸šé¡¹ç›®ç®¡ç†ç³»ç»Ÿ",
      "description": "é¡¹ç›®æè¿°",
      "key": "EPM",
      "status": "active",
      "owner_id": 1,
      "start_date": "2026-01-01T00:00:00",
      "end_date": "2026-03-31T00:00:00",
      "created_at": "2026-01-01T00:00:00",
      "updated_at": "2026-02-08T10:00:00"
    }
  ],
  "total": 5,
  "skip": 0,
  "limit": 100
}
```

### 2.2 åˆ›å»ºé¡¹ç›®
```
POST /projects
Authorization: Bearer {token}

Request:
- name: string (required)
- key: string (required, max 10 chars)
- description: string (optional)
- start_date: datetime (optional)
- end_date: datetime (optional)

Response (200):
{
  "message": "Project created successfully",
  "project": {
    "id": 1,
    "name": "æ–°é¡¹ç›®",
    "key": "NEWPROJ",
    "description": "æè¿°",
    "status": "planning",
    "owner_id": 1
  }
}
```

### 2.3 é¡¹ç›®è¯¦æƒ…
```
GET /projects/{id}
Authorization: Bearer {token}

Response (200):
{
  "project": {
    "id": 1,
    "name": "é¡¹ç›®å",
    "description": "æè¿°",
    "key": "PROJ",
    "status": "active",
    "owner_id": 1,
    "start_date": "2026-01-01",
    "end_date": "2026-03-31"
  },
  "stats": {
    "total_tasks": 50,
    "completed_tasks": 30,
    "milestones": 5,
    "progress": 60.0
  },
  "user_role": "admin"
}
```

### 2.4 æ›´æ–°é¡¹ç›®
```
PUT /projects/{id}
Authorization: Bearer {token}

Request:
- name: string (optional)
- description: string (optional)
- status: ProjectStatus (optional)
- start_date: datetime (optional)
- end_date: datetime (optional)

Response (200):
{
  "message": "Project updated successfully",
  "project": { ... }
}
```

### 2.5 åˆ é™¤é¡¹ç›®
```
DELETE /projects/{id}
Authorization: Bearer {token}

Response (200):
{
  "message": "Project deleted successfully"
}
```

---

## 3. é¡¹ç›®æˆå‘˜ç®¡ç†

### 3.1 æˆå‘˜åˆ—è¡¨
```
GET /projects/{id}/members
Authorization: Bearer {token}

Response (200):
{
  "items": [
    {
      "id": 1,
      "project_id": 1,
      "user_id": 1,
      "role": "admin",
      "joined_at": "2026-01-01T00:00:00"
    }
  ],
  "total": 3
}
```

### 3.2 æ·»åŠ æˆå‘˜
```
POST /projects/{id}/members
Authorization: Bearer {token}

Request:
- user_id: number (required)
- role: admin | manager | member | viewer (default: member)

Response (200):
{
  "message": "Member added successfully",
  "member": { ... }
}
```

### 3.3 ç§»é™¤æˆå‘˜
```
DELETE /projects/{id}/members/{user_id}
Authorization: Bearer {token}

Response (200):
{
  "message": "Member removed successfully"
}
```

---

## 4. é‡Œç¨‹ç¢‘ç®¡ç†

### 4.1 é‡Œç¨‹ç¢‘åˆ—è¡¨
```
GET /projects/{id}/milestones
Authorization: Bearer {token}

Response (200):
{
  "items": [
    {
      "id": 1,
      "project_id": 1,
      "name": "v1.0 Release",
      "description": "ç¬¬ä¸€ç‰ˆå‘å¸ƒ",
      "due_date": "2026-03-31T00:00:00",
      "status": "pending",
      "completed_at": null,
      "created_at": "2026-01-01T00:00:00"
    }
  ],
  "total": 2
}
```

### 4.2 åˆ›å»ºé‡Œç¨‹ç¢‘
```
POST /projects/{id}/milestones
Authorization: Bearer {token}

Request:
- name: string (required)
- description: string (optional)
- due_date: datetime (optional)

Response (200):
{
  "message": "Milestone created successfully",
  "milestone": { ... }
}
```

---

## 5. ä»»åŠ¡ç®¡ç†

### 5.1 ä»»åŠ¡åˆ—è¡¨
```
GET /projects/{id}/tasks
Authorization: Bearer {token}

Query Parameters:
- skip: number (default: 0)
- limit: number (default: 100)
- status: todo | in_progress | review | done | archived
- priority: low | medium | high | urgent
- assignee_id: number

Response (200):
{
  "items": [
    {
      "id": 1,
      "project_id": 1,
      "parent_id": null,
      "title": "å®Œæˆéœ€æ±‚åˆ†æ",
      "description": "è¯¦ç»†æè¿°...",
      "status": "in_progress",
      "priority": "high",
      "assignee_id": 1,
      "created_by_id": 1,
      "start_date": "2026-01-01",
      "due_date": "2026-01-15",
      "completed_at": null,
      "estimated_hours": 40,
      "progress": 50,
      "created_at": "2026-01-01T00:00:00",
      "updated_at": "2026-02-08T10:00:00"
    }
  ],
  "total": 20,
  "skip": 0,
  "limit": 100
}
```

### 5.2 åˆ›å»ºä»»åŠ¡
```
POST /projects/{id}/tasks
Authorization: Bearer {token}

Request:
- title: string (required)
- description: string (optional)
- parent_id: number (optional, çˆ¶ä»»åŠ¡ID)
- priority: low | medium | high | urgent (default: medium)
- assignee_id: number (optional)
- start_date: datetime (optional)
- due_date: datetime (optional)
- estimated_hours: number (optional)
- labels: number[] (optional)

Response (200):
{
  "message": "Task created successfully",
  "task": { ... }
}
```

### 5.3 ä»»åŠ¡è¯¦æƒ…
```
GET /projects/{id}/tasks/{task_id}
Authorization: Bearer {token}

Response (200):
{
  "task": { ...å®Œæ•´ä»»åŠ¡ä¿¡æ¯ },
  "subtasks": [ ...å­ä»»åŠ¡åˆ—è¡¨ ],
  "comments": [ ...è¯„è®ºåˆ—è¡¨ ],
  "labels": [ ...æ ‡ç­¾åˆ—è¡¨ ]
}
```

### 5.4 æ›´æ–°ä»»åŠ¡
```
PUT /projects/{id}/tasks/{task_id}
Authorization: Bearer {token}

Request:
- title: string (optional)
- description: string (optional)
- status: todo | in_progress | review | done (optional)
- priority: low | medium | high | urgent (optional)
- assignee_id: number (optional)
- start_date: datetime (optional)
- due_date: datetime (optional)
- estimated_hours: number (optional)
- progress: number (0-100, optional)

Response (200):
{
  "message": "Task updated successfully",
  "task": { ... }
}
```

### 5.5 åˆ é™¤ä»»åŠ¡
```
DELETE /projects/{id}/tasks/{task_id}
Authorization: Bearer {token}

Response (200):
{
  "message": "Task deleted successfully"
}
```

---

## 6. ä»»åŠ¡è¯„è®º

### 6.1 æ·»åŠ è¯„è®º
```
POST /projects/{id}/tasks/{task_id}/comments
Authorization: Bearer {token}

Request:
- content: string (required)

Response (200):
{
  "message": "Comment added successfully",
  "comment": {
    "id": 1,
    "task_id": 1,
    "author_id": 1,
    "content": "è¯„è®ºå†…å®¹",
    "created_at": "2026-02-08T10:00:00"
  }
}
```

### 6.2 è¯„è®ºåˆ—è¡¨
```
GET /projects/{id}/tasks/{task_id}/comments
Authorization: Bearer {token}

Response (200):
{
  "items": [ ... ],
  "total": 5
}
```

---

## 7. ä»»åŠ¡æ ‡ç­¾

### 7.1 æ ‡ç­¾åˆ—è¡¨
```
GET /projects/{id}/labels
Authorization: Bearer {token}

Response (200):
{
  "items": [
    {
      "id": 1,
      "name": "Bug",
      "color": "#ff0000",
      "project_id": 1,
      "created_at": "2026-01-01T00:00:00"
    }
  ],
  "total": 3
}
```

### 7.2 åˆ›å»ºæ ‡ç­¾
```
POST /projects/{id}/labels
Authorization: Bearer {token}

Request:
- name: string (required)
- color: string (default: #0079bf)

Response (200):
{
  "message": "Label created successfully",
  "label": { ... }
}
```

---

## 8. èµ„æºç®¡ç†

### 8.1 ç”¨æˆ·åˆ—è¡¨
```
GET /resources/users
Authorization: Bearer {token}

Query Parameters:
- role: string (optional)
- is_active: boolean (default: true)

Response (200):
{
  "items": [
    {
      "id": 1,
      "username": "testuser",
      "email": "test@example.com",
      "full_name": "Test User",
      "role": "member",
      "avatar": null,
      "created_at": "2026-02-08T10:00:00"
    }
  ],
  "total": 5
}
```

### 8.2 ç”¨æˆ·è¯¦æƒ…
```
GET /resources/users/{user_id}
Authorization: Bearer {token}

Response (200):
{
  "user": { ...ç”¨æˆ·ä¿¡æ¯ },
  "projects": [ ...ç”¨æˆ·å‚ä¸çš„é¡¹ç›® ],
  "task_stats": {
    "todo": 5,
    "in_progress": 3,
    "done": 10
  },
  "pending_tasks": [ ...å¾…å¤„ç†ä»»åŠ¡ ]
}
```

### 8.3 å›¢é˜Ÿå·¥ä½œè´Ÿè½½
```
GET /resources/workload
Authorization: Bearer {token}

Response (200):
{
  "items": [
    {
      "user": {
        "id": 1,
        "username": "testuser",
        "full_name": "Test User",
        "avatar": null
      },
      "project_count": 2,
      "total_tasks": 18,
      "completed_tasks": 10,
      "in_progress_tasks": 5,
      "workload_score": 45,
      "workload_level": "medium"
    }
  ],
  "total": 5
}
```

### 8.4 èµ„æºåˆ©ç”¨ç‡
```
GET /resources/utilization
Authorization: Bearer {token}

Query Parameters:
- project_id: number (optional)

Response (200):
{
  "items": [
    {
      "user_id": 1,
      "username": "testuser",
      "full_name": "Test User",
      "assigned_tasks": 8
    }
  ],
  "total": 5
}
```

---

## 9. é”™è¯¯å¤„ç†

### é”™è¯¯å“åº”æ ¼å¼
```
{
  "detail": "Error message"
}
```

### å¸¸è§é”™è¯¯ç 

| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | æœªæˆæƒ (Invalid credentials) |
| 403 | æ— æƒé™ (Insufficient permissions) |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨é”™è¯¯ |

---

## 10. æšä¸¾å€¼è¯´æ˜

### UserRole (ç”¨æˆ·è§’è‰²)
- `admin` - ç®¡ç†å‘˜
- `manager` - é¡¹ç›®ç»ç†
- `member` - æˆå‘˜
- `viewer` - æŸ¥çœ‹è€…

### ProjectStatus (é¡¹ç›®çŠ¶æ€)
- `planning` - è§„åˆ’ä¸­
- `active` - è¿›è¡Œä¸­
- `on_hold` - æš‚åœ
- `completed` - å·²å®Œæˆ
- `archived` - å·²å½’æ¡£

### TaskStatus (ä»»åŠ¡çŠ¶æ€)
- `todo` - å¾…åŠ
- `in_progress` - è¿›è¡Œä¸­
- `review` - å®¡æ ¸ä¸­
- `done` - å·²å®Œæˆ
- `archived` - å·²å½’æ¡£

### TaskPriority (ä»»åŠ¡ä¼˜å…ˆçº§)
- `low` - ä½
- `medium` - ä¸­
- `high` - é«˜
- `urgent` - ç´§æ€¥

---

## 11. å˜æ›´è®°å½•

| æ—¥æœŸ | ç‰ˆæœ¬ | å˜æ›´å†…å®¹ |
|------|------|---------|
| 2026-02-08 | v1.0 | åˆå§‹APIæ–‡æ¡£ |
| 2026-02-10 | v1.1 | æ›´æ–°ä¸ºFastAPIå®é™…å®ç°æ–‡æ¡£ |
